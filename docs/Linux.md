# Linux开发环境基础知识

<table><tr><td bgcolor=#E6E6FA>
 学习建议 ：《鸟哥的Linux私房菜（基础学习篇）》
</td></tr></table>

## 1. 如何登陆Linux

使用VSCode登录远程实验平台，参考[远程实验环境使用指南](../remote_env/)

在本地电脑上启动Linux，直接启动虚拟机或WSL环境即可

登录到远程服务器上的Linux平台，可以使用MobaXterm、Windows Terminal、putty等工具远程登录

## 2. 常用文件管理命令

### Linux文件管理

Linux文件路径的描述本质上是一棵树，目录和文件就是树中的各种节点

根目录 `/` : 根目录是文件系统这棵树的根节点。通过 `cd /` 命令进入根目录，输入 `ls` 并回车，可以看到以下文件夹

- `bin` :存储常用可执行文件的命令
- `etc` :代理服务器的配置文件
- `var` :里面会有log(日志)
- `lib` ：安装包和库文件（静态连接库）等
- `home` ：用户的家目录
- `proc` ：进程相关的信息，计算机信息

#### Linux路径描述

执行 `cd ~` 命令回到家目录，执行以下两个命令：

```bash
mkdir tmp
touch tmp/main.cpp
```

如何描述这个 `main.cpp` 文件的路径呢？Linux里有两种方式

- 绝对路径：从根目录开始描述路径。`main.cpp` 的绝对路径描述是 `/home/学号/tmp/main.cpp`
    - 绝对路径的描述一定以根目录 `/` 开头
- 相对路径：从当前目录开始描述路径。`main.cpp` 的相对路径描述是 `tmp/main.cpp`

大家可以随时通过 `pwd` 命令查看当前路径，`pwd` 命令的输出是当前命令的绝对路径描述

在路径描述里，Linux有三个特殊目录:

- `.` 目录：表示当前目录。执行 `cd .` 不会改变当前路径
- `..` 目录：表示上一级目录
    - 大家执行 `cd tmp` 进入 `tmp` 文件夹，再执行 `cd ..` 就回到上一级的家目录了
- `~` : 家目录，不论在哪个目录下，只要执行 `cd ~` 就会回到家目录
    - 描述家目录下的 `tmp` 文件夹也可以用 `~/tmp` 来描述

### 常用命令介绍

- ctrl + c : 中止当前进程
    - 大家可以执行 `top` 命令，该命令会启动一个进程并展示当前运行的进程信息。之后使用 ctrl + c 就可以退出 `top` 的进程
    - 其他进程同理，都可以在终端使用 ctrl + c 进行中止
- ctrl + u: 清空本行命令。
- `tab`键：可以补全命令和文件名，如果补全不了快速按两下`tab`键，可以显示备选选项
- 方向键 ↑ 可以调出历史指令
- `ls` : 列出当前目录下所有文件，蓝色的是文件夹，白色的是普通文件，绿色的是可执行文件
    - `ls -l` : 给出详细信息
    - `ls -hl` : 人性化详细信息(把字节改成多少k或者m)
    - `-a` : 查询所有文件（包括隐藏文件）(所有以.开头的文件都是隐藏文件)
- `pwd`: 显示当前路径
- `cd 目录路径`: 进入到目录路径下
    - `cd` : 不加路径则返回家目录
    - `cd -` : 返回上一个待过的路径
    - `cd ..` 返回上层目录
- `cp 文件1 文件2` : 将 `文件1` 复制成 `文件2` ， `文件1` 和 `文件2` 可以是一个路径，比如 `../dir_c/a.txt` ，表示上层目录下的 `dir_c` 文件夹下的文件 `a.txt`
    - `cp a b -r` : 把文件夹a复制到文件夹b中
- `mkdir 目录名` : 创建目录
    - 想创建 'g s' 这种中间有空格的文件夹时 要在g后面加上\转义字符 即 `mkdir g\ s`
    - `mkdir a/b/c -p` : 创建a文件夹 里面包含b b里面包含c (创建一串文件夹)
- `rm 文件名` : 删除普通文件; `rm 目录名 -r` : 删除文件夹
    - `-r` : 递归删（用于删文件夹）
    - `*` : 文件夹里所有的东西(不包括隐藏文件)(正则表达式的规则)
    - `-f` : 对被保护的文件进行操作。这个参数具有一定危险性，使用之前请先询问老师和助教
- `mv 文件名 目录` : 将文件移动到对应目录里
    - `mv a.txt b.txt` : 将 `a.txt` 重命名为 `b.txt`
- `touch 文件名` : 创建一个文件
- `cat 文件名` : 展示文件中的内容
- 复制文本: (windows/Linux下) Ctrl + insert ，(Mac下)command + c
- 粘贴文本: (windows/Linux下) Shift + insert ，(Mac下) command + v

## 3. Tmux的使用

Tmux是一个非常好用的终端进程管理软件，我们将用到它的两个功能:

1. 分屏
2. 允许断开Terminal连接后，继续运行进程。(这个功能很重要，如果在做实验的时候vscode或者终端突然被关掉，可能终端里进程运行的结果就全都打水漂了。但如果进程运行在Tmux里，终端被关掉只是相当于Tmux会话被挂起了，进程运行不会受到影响，重新打开终端仍然可以进入被挂起的Tmux会话，这样就不用担心终端意外退出带来的损失了:)

启动Tmux, 直接在终端输入 `tmux` 并回车，就进入Tmux了

### Tmux操作

#### 前缀键

Tmux 窗口有大量的快捷键。所有快捷键都要通过前缀键唤起。默认的前缀键是Ctrl + b，即先按下Ctrl+b，快捷键才会生效。

举例来说，帮助命令的快捷键是`Ctrl+b ?`。它的用法是，在 Tmux 窗口中，先按下Ctrl+b，再按下`?`，就会显示帮助信息。

然后，按下 `ESC` 键或`q`键，或使用Ctrl + c, 就可以退出帮助。

#### Tmux分屏管理

- 左右分屏：在Tmux窗口，先按下前缀键 Ctrl + b, 再按下 `%` (也就是shift + 横排数字键5)
- 上下分屏：在Tmux窗口，先按下前缀键 Ctrl + b, 再按下 `"`
- 选择分屏：在Tmux窗口，先按下前缀键 Ctrl + b, 再按下方向键来选择窗口
- 浏览窗口：在Tmux窗口，先按下前缀键 Ctrl + b, 再按下 `[` ，之后滚动鼠标滚轮，或使用上下方向键都可以浏览窗口内容
    - 退出浏览，按下Ctrl + c
- 关闭当前窗口：在Tmux窗口按下 Ctrl + d
- 挂起当前Tmux窗口：在Tmux窗口，先按下前缀键 Ctrl + b, 再按下d (也可以直接把终端关掉)
- 回到挂起的Tmux窗口：在终端输入 `tmux a` 并回车，即可回到挂起的Tmux窗口

## 4. 常用git命令

### git作用

将项目代码的历史版本用树的结构维护出来，便于开发者查找和回稳历史代码，还支持代码合并

将代码上传到云仓库托管，便于多人开发

### git基本概念

- 工作区：仓库的目录。工作区是独立于各个分支的。
- 暂存区：数据暂时存放的区域，类似于工作区写入版本库前的缓存区。暂存区是独立于各个分支的，意思就是所有分支共用一个暂存区
- 版本库：存放所有已经提交到本地仓库的代码版本
- 版本结构：树结构，树中每个节点代表一个代码版本。
- 分支：一般多人开发不会直接在主分支开发，而是从各个节点开辟新分支，开发完后再进行合并

### git常用命令

1. `git config --global user.name 你的用户名`：设置全局用户名，信息记录在 `~/.gitconfig`文件中
2. `git config --global user.email 你的邮箱`：设置全局邮箱地址，信息记录在 `~/.gitconfig`文件中
    - 上述两个命令在家目录中执行
3. `git add 文件名`：将文件（的修改）添加到暂存区
    - `git add .`：将所有待加入暂存区的文件加入暂存区
    - `git add` 本质是将文件的修改状态加入到暂存区，让暂存区知道文件被创建、被修改还是被删除
4. `git restore 文件名`:将已修改但未更新至暂存区的文件还原成暂存区版本（执行前提是暂存区有被维护的文件版本）
    - `git restore --staged 文件名` :将未更新至版本库的暂存区文件还原成版本库中的HEAD指针指向的版本
5. `git commit -m "本次提交的描述信息"`：将暂存区的内容提交到当前分支（不会删暂存区文件）
    - 所以如果只想提交部分文件，就只把那要提交的部分 `git add` 进暂存区
6. `git status`：查看仓库状态
7. `git diff 文件名`：查看文件相对于暂存区修改了哪些内容
    - 会显示哪些行是修改过的，但不会显示到哪些字符是修改过的
    - 如果暂存区中没有这个文件或该文件与暂存区版本一致，则不输出内容
8.  `git clone 仓库链接`：将远程仓库下载到当前目录下
9.  `git branch`：查看所有分支和当前所处分支
    - 带 `*` 的是当前所在的分支
10. `git checkout 分支名`：切换到对应分支
11. `git pull`：将远程仓库的当前分支与本地仓库的当前分支合并
    - `git pull origin 分支名`：将远程仓库的对应分支与本地仓库的当前分支合并

## 5. 管道、环境变量与开发常用命令

### 管道 Pipeline

管道类似于文件重定向，可以将前一个命令的 `stdout`，重定向到下一个命令的 `stdin` ，也就是将一个命令在终端的输出，变为另一个命令接受的输入

#### 管道命令要点

1. 管道命令仅处理 `stdout` ，会忽略 `stderr` 。
2. 管道右边的命令必须能接受 `stdin` 。
3. 多个管道命令可以串联。

#### 管道命令举例

统计当前目录下所有c语言文件的总行数，其中 `find` 、 `xargs` 、 `wc` 等命令可以参考开发常用命令这一节内容。

大家可以在实验目录xv6-oslab24-hitsz下执行以下命令(注意切换到除了main以外的分支，比如执行 `git checkout util`)

```bash
find . -name '*.c' | xargs cat | wc -l
```

### 环境变量

#### 环境变量概念

Linux系统中会用很多环境变量来记录 **配置信息** 。

环境变量类似于全局变量，可以被各个进程访问到。我们可以通过修改环境变量来方便地修改系统配置。

#### 查看环境变量

列出当前环境下的所有环境变量：

```bash
env  # 显示当前用户的变量
set  # 显示当前shell的变量，包括当前用户的变量;
export  # 显示当前导出成用户变量的shell变量
```

输出某个环境变量的值：

```bash
echo $PATH  # 输出PATH环境变量的值
```

#### 修改环境变量

（修改环境变量需谨慎，如果错误地修改了环境变量可能导致实验无法进行。如有涉及到修改环境变量的操作，请严格按照实验指导书；如果出现问题，请及时联系老师或助教）

修改PATH环境变量：

```bash
export PATH=$PATH:/test
echo $PATH  # 执行完后会发现，输出最后多出来了:/test
```

在当前 `shell` 环境下修改的环境变量只在当前环境中有效。

为了将对环境变量的修改应用到未来所有环境下，可以将修改命令放到 `~/.bashrc` 文件中，建议直接把修改语句写在文件最后，因为每次执行 `bash` 都是从上往下执行，后执行的可以覆盖先执行的。

修改完 `~/.bashrc` 文件后，记得执行 `source ~/.bashrc` ，来将修改应用到当前的 `bash` 环境下。

为何将修改命令放到 `~/.bashrc` ，就可以确保修改会影响未来所有的环境呢？

- 每次启动 `bash` ，都会先执行 `~/.bashrc` 。
- 每次 `ssh` 登陆远程服务器，都会启动一个 `bash` 命令行给我们。
- 每次 `tmux` 新开一个 `pane` ，都会启动一个 `bash` 命令行给我们。
- 所以未来所有新开的环境都会加载我们修改的内容。

### 常见环境变量

1. `HOME` ：用户的家目录。
2. `PATH` ：可执行文件（命令）的存储路径。路径与路径之间用:分隔。当某个可执行文件同时出现在多个路径中时，会选择从左到右数第一个路径中的执行。**下列所有存储路径的环境变量，均采用从左到右的优先顺序。**
    - 当执行一个命令时，操作系统会在 `PATH` 的存储路径里从左到右依次找，直到找到第一个匹配的可执行文件。因此新加入命令时，最好把路径写在原 `PATH` 的前面，保证命令能够被执行
    - 当一个库出现在多个环境变量的路径中时，系统只会找到最左路径里的库文件。如果只修改了靠后路径中该库的代码，程序执行时依然会执行修改前的版本而不会执行修改后的版本。因此在更新库文件的代码时一定要更新最左路径里的库文件（最好全部更新）
3. `LD_LIBRARY_PATH` ：用于指定动态链接库(.so文件)的路径，其内容是以冒号分隔的路径列表（除了这里的目录，操作系统也会去一些默认的专门放.so文件的目录找动态链接库）。
    - [静态库VS动态库](https://cloud.tencent.com/developer/article/1656728)
    - C或C++程序使用的库函数来自静态链接库或动态链接库。
        - 静态链接库的函数代码在编译时会被载入目标程序中，程序运行时不需要再次访问静态库；会导致可执行文件体积增大，且修改静态库函数后，涉及的程序需要重新编译
        - 动态链接库的函数代码不会载入目标程序，目标程序在编译链接后只会保留库函数的接口。当程序执行到使用库函数时，程序会根据操作系统 `LD_LIBRARY_PATH` 里的路径找到相应动态库里的函数并执行。程序执行时需要访问动态库；可执行文件体积不受函数影响，且修改动态库后涉及的程序不需要重新编译
4. `C_INCLUDE_PATH` ：C语言的头文件路径，内容是以冒号分隔的路径列表。
5. `CPLUS_INCLUDE_PATH` ：CPP的头文件路径，内容是以冒号分隔的路径列表。
6. `PYTHONPATH` ：Python导入包的路径，内容是以冒号分隔的路径列表。
7. `JAVA_HOME` ：jdk的安装目录。
8. `CLASSPATH` ：存放Java导入类的路径，内容是以冒号分隔的路径列表。

### 开发常用命令

Linux命令非常多，本节讲解几个常用命令。其他命令依赖于大家根据实际操作环境，边用边查。

不会使用某个命令，可以用 `man 命令` 或 `命令 --help` 来查看命令说明

#### 系统状况

1. `top` ：查看所有进程的信息（Linux的任务管理器）
    - 打开后，输入 `M` ：按使用内存排序
    - 打开后，输入 `P` ：按使用CPU排序
    - 打开后，输入 `q` ：退出
2. `df -h` ：查看硬盘使用情况
3. `free -h` ：查看内存使用情况
4. `du -sh` ：查看当前目录占用的硬盘空间
5. `ps aux` ：查看所有进程
6. `kill -9 pid` ：杀死编号为 `pid` 的进程
    - 传递某个具体的信号： `kill -s SIGTERM pid`（某些程序必须要用term结束而不能杀死，因此关闭某个程序最好先查文档看应该怎么关）
    - `9` 是 `SIGKILL` 信号的编号， `SIGTERM` 的编号是 `15`
    - kill表示杀死进程，term表示正常结束一个进程
7. `netstat -nt` ：查看所有网络连接
8. `w` ：列出当前登陆的用户
9. `ping www.baidu.com` ：检查是否连网
    1. Linux上的ping命令是不会自动终止的，需要使用Ctrl + c终止

#### 文件权限

1. `chmod` ：修改文件权限
    - `chmod +x 文件名` ：给文件添加可执行权限
        - 执行这个文件程序：`./文件路径` （如果文件在当前目录下，则 `./文件名`）
    - `chmod -x 文件名` ：去掉文件的可执行权限
    - `chmod 777 文件名` ：将文件名的权限改成777
        - 三位数，每一位对应一组的权限。每位数字取值0~7，转化成二进制就是三位，每一位上，1表示有权限，0表示无权限
    - `chmod 777 目录名 -R` ：递归修改整个文件夹的权限
    - 补充：文件的权限表示有10位
        - 第一位表示是否是文件夹或超链接（快捷方式）
        - 后9位按序每三位一组
        - 三位中从前往后分别表示可读权限，可写权限，可执行权限
        - 三组从前往后分别表示自己的权限，同组用户的权限，其他用户的权限
        - 举例：在终端输入 `ls -l` ,可以看到所有文件的权限。假设在家目录下有一个 `main.sh` 脚本文件，它的权限是 `-rw-r--r--` ，则
            - 第1位是 `-` ,表示是普通文件
            - 第2到4位是 `rw-` , 表示这个文件用户自己可以读和写，但是不能执行
            - 第5到7位是 `r--` , 表示这个文件，同组的其他用户只能读，不能写和执行
            - 第8到10位是 `r--` , 表示这个文件，系统里的其他用户只能读，不能写和执行
            - 如果执行 `chmod +x main.sh` , 则权限第4位会变为 `x` ，表示这个文件可以执行。
            - 在家目录下执行 `main.sh` , 使用 `./main.sh` 命令即可

#### 文件检索

1. `find 目录路径 -name '*.c'` ：搜索某个文件路径下的所有后缀为.c的文件
2. `grep xxx` ：从 `stdin` 中读入若干行数据，如果某行中包含 `xxx` ，则输出该行；否则忽略该行。
    1. `grep XXX 文件名或正则表达式` ：查找名称匹配文件名或正则表达式的文件里，有没有XXX字符串
3. `wc` ：统计行数、单词数、字节数
    - 既可以从 `stdin` 中直接读入内容；也可以在命令行参数中传入文件名列表；
    - `wc 文件名` 按序输出行数、单词数，字节数
    - `wc -l` ：统计行数
    - `wc -w` ：统计单词数
    - `wc -c` ：统计字节数
4. `cut` ：分割一行内容
    - 从 `stdin` 中读入多行数据
    - `echo $PATH | cut -d ':' -f 3,5` ：输出 `PATH` 用 `:` 分割后第3、5列数据
    - `echo $PATH | cut -d ':' -f 3-5` ：输出 `PATH` 用 `:` 分割后第3-5列数据
    - `echo $PATH | cut -c 3,5` ：输出 `PATH` 的第3、5个字符
    - `echo $PATH | cut -c 3-5` ：输出 `PATH` 的第3-5个字符
5. `sort` ：将每行内容按字典序排序
    - 可以从 `stdin` 中读取多行数据
    - 可以从命令行参数中读取文件名列表
6. `xargs` ：将 `stdin` 中的数据用空格或回车分割成命令行参数
    - `find . -name '*.c' | xargs cat | wc -l` ：统计当前目录下所有c文件的总行数
    - 如果不加 `xargs` 也会有输出，但是这个输出统计的不是 `.c` 文件。不加 `xargs` , `cat` 输出的就是 `stdin` 文件的内容，统计的也就是 `stdin` 的行数

#### 查看文件内容

1. `more 文件名` ：浏览文件内容
    - 回车：下一行
    - 空格：下一页
    - `b` ：上一页
    - `q` ：退出
2. `less 文件名` ：与 `more` 类似，功能更全
    - 回车：下一行
    - `y` ：上一行
    - `Page Down` ：下一页
    - `Page Up` ：上一页
    - `q` ：退出
3. `head -3 文件名` ：展示文件的前3行内容
    - 同时支持从 `stdin` 读入内容
4. `tail -3 文件名` ：展示文件末尾3行内容
    - 同时支持从 `stdin` 读入内容

### 用户相关

1. `history` ：展示当前用户的历史操作。内容存放在 `~/.bash_history` 中
    - `history` 展示的历史操作包含当前bash界面用户使用过的后2000条操作，而 `.bash_history` 里的历史操作不包含当前未关闭的bash里的操作。只有关闭bash之后，才会把操作写入 `.bash_history` 文件

### 工具

1. `md5sum 文件名` ：计算 `md5` 哈希值
    - 计算任意长度的字符串的哈希值
    - 可以从 `stdin` 读入内容
    - 也可以在命令行参数中传入文件名列表；
    - 一般计算文件的哈希值，用于核对文件是否准确且完好无损
    - 也可以用于加密信息，比如加密密码
        - 数据库存储密码时都不会存储原密码字符串，而是存储密码的哈希值。哈希值几乎不可能反推。用户输入密码后，先转化成哈希值再比对。所以如果忘记密码就只能重设密码，而不能找回密码
2. `time 命令` ：统计命令的执行时间
3. `watch -n 0.1 命令` ：每0.1秒执行一次命令
4. `tar` ：压缩文件
    - `tar -zcvf 压缩文件名.tar.gz 目录路径/*` ：将目标文件夹下所有文件压缩为 `.tar.gz` 类型文件
    - `tar -zxvf 压缩文件名.tar.gz` ：解压缩
5. `diff 文件名1 文件名2` ：查找文件的不同点

## 6. 查看系统信息

- 查看系统信息：`cat /etc/os-release`
- 查看 CPU 信息：`lscpu`
- 查看内存信息：`free`
- 查看磁盘信息：`fdisk -l`
- 显示当前的日期和本地时间：`date`
- 显示当前的日期和 UTC 时间：`date --utc/--u`
